app-id: com.barebaric.rayforge
runtime: org.gnome.Platform
runtime-version: '47'
sdk: org.gnome.Sdk
command: rayforge

finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --device=all
  - --env=DISPLAY=:0
  - --share=network

modules:
  - python3-meson-python.yml   # This is a numpy/scipy requirement
  - python3-scikit-build.yml   # opencv-python requirement
  - python3-pythran.yml        # scipy-python requirement
  - python3-pybind11.yml       # scipy-python requirement
  - python3-openblas.yml       # scipy-python requirement
  - python3-pyvips.yml
  - python3-pypotrace.yml
  - python3-setuptools-git-versioning.yml
  - python3-requirements.yml

  - name: rayforge
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation .
    post-install:
      - install -Dm644 data/${FLATPAK_ID}.svg /app/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg
      - install -Dm644 data/${FLATPAK_ID}.desktop /app/share/applications/${FLATPAK_ID}.desktop
    sources:
      - type: git 
        url: https://github.com/barebaric/rayforge.git
        branch: main
